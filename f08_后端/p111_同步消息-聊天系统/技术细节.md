client
不丢失 不重复 不乱序

ws心跳检测

client-> 主动断开函数
client-> 突然断开 (心跳检测 server 判断 client 是否还在连接)

心跳检测
client 不断向 server 发送个消息 
如果超时不发送 则视为断开
如果收到 则重置时间
触发断开函数

聊天室(群)


user_client -- ws_client -- mq 
user_client -- ws_client(聊天群)  -> ws_set()
user_client -- ws_client(聊天群) 

心跳机制 发现 连接关闭

user_client -- 订阅mq 


rabbitmq 三种模式



# 1 流程细节
rabbitmq 三种模式
-fanout 发送到所有订阅者
-direct 发送到 完全匹配 的订阅者
-topic 发送到 通配符匹配 的订阅者
# 2 技术细节
# 3 代码细节


rabbitmq 单聊模式
(性能 fanout模式 > topic模式)
rabbitmq-fanout模式
u1 -> exchange(u2接收) -> u2_pc_queue + u2_phone_quque

u1 -> exchange(u1接收) -> u1_pc_queue + u1_phone_quque
           

rabbitmq-topic模式
u1 ──┐                              ┌──> u1_pc_queue + u1_phone_quque
u2 ──┼──> exchange(user自查找接收) ──┼──> u2_pc_queue + u2_phone_quque
u3 ──┘                              └──> u3_pc_queue + u3_phone_quque


rabbitmq 群聊模式
rabbitmq-fanout模式
                     ┌──> u1_pc_queue + u1_phone_quque
u1 -> exchange(g1) ──┼──> u2_pc_queue + u2_phone_quque
                     └──> u3_pc_queue + u3_phone_quque
                     ┌──> u1_pc_queue + u1_phone_quque
u2 -> exchange(g1) ──┼──> u2_pc_queue + u2_phone_quque
                     └──> u3_pc_queue + u3_phone_quque

rabbitmq-topic模式
u1 ──┐                     ┌──> u1_pc_queue + u1_phone_quque
u2 ──┼──> exchange(g) ──┼──> u2_pc_queue + u2_phone_quque
u3 ──┘                     └──> u3_pc_queue + u3_phone_quque